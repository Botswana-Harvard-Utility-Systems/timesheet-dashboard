{% extends listboard_base_template %}
{% load admin_urls %}
{% load edc_base_extras %}
{% load timesheet_dashboard_extras %}
{% load edc_dashboard_extras %}

{% block extra-css %}
<style>
	.table-sm td, .table-sm th { padding: .5rem .50rem; }
	.md-card {
	  background: var(--bs-body-bg);
	  border-radius: 4px;
	  box-shadow: 0 1px 1px rgba(0,0,0, .06), 0 1px 5px rgba(0,0,0,.06);
	  border: 1px solid rgba(0,0,0,.06);
	  overflow: hidden;
	}
	.md-card #details {
		padding: 1rem .75rem;
	}
	@media (prefers-color-scheme: dark) {
	  .md-card { 
	  	border-color: rgba(255, 255, 255, .08);
	  }
	}
</style>

{% endblock %}

{% block main %}

<div class="row g-3">
  <!-- Main table -->
  <div class="col-12 col-lg-9">
    <div class="d-flex align-items-center justify-content-between mb-3">
    	<div>
      		<h1 class="h4 mb-0">{% if not p_role %} My {% endif %} Timesheets</h1>
      		<nav aria-label="breadcrumb" class="small">
	          <ol class="breadcrumb mb-0">
	            <li class="breadcrumb-item"><a href="{% url 'timesheet:timesheet_home_url' %}">Timesheet Dashboard</a></li>
	            <li class="breadcrumb-item active">{% if not p_role %} My {% endif %} Timesheets</li>
	          </ol>
	        </nav>
        </div>
        {% if timesheet_add_url %}
	    	<a id="btn-dashboard" class="btn btn-sm btn-outline-primary" role="button"
	     		title="Add Timesheet" href="{% url 'timesheet_dashboard:timesheet_calendar_table_url' employee_id  curr_year curr_month%}">
	     		<i class="bi bi-plus-circle"></i> Add Timesheet
	     	</a>
	    {% endif %}
        {% block listboard_search_form %}
        	{% include 'timesheet_dashboard/search_form.html' %}
      	{% endblock listboard_search_form %}
    </div>

	<div class="md-card">
		<div class="card-body p-0">
    		<div class="table-responsive">
      			<table class="table table-hover small align-middle table-sm">
        			<thead class="table-primary">
        			{% block listboard_table_header %}
        				<tr>
				          <th>#</th>
				          <th></th>
				          {% if p_role == 'HR' or p_role == 'Supervisor' %}
						  	<th>Name </th>
						  {% endif %}
				          <th>Month</th>
						  <th>Duration</th>
						  <th>Status</th>
						  <th>Submitted</th>
						  <th>Approved By</th>
						  <th>Verified By</th>
						</tr>
	   				{% endblock listboard_table_header %}
					</thead>
        			<tbody>
        			{% block listboard_table_body %}
        	 			{% for result in results %}
			        	 <tr>
			        	 	<td>{{ forloop.counter }}</td>
			        	 	{% block listboard_table_button_column %}
			        	 		<td>
			        	 			<div class="btn-group" role="group" aria-label="Timesheet Links">
			        	 			{% if timesheet_add_url %}
			        	 				{% submit_timesheet_button result %}
			        	 			{% endif %}
			        	 			
			        	 			{% if p_role == 'HR' or p_role == 'Supervisor' %}
			        	 				{% if result.status == 'rejected' %}
			        	 				<a 	id="submit_timesheet_{{employee_id}}"
			        	 					title="View Timesheet"
			        	 					data-toggle="tooltip"
			        	 					data-placement="right"
			        	 					class="btn btn-danger btn-sm"
			        	 					href="{% url 'timesheet_dashboard:timesheet_calendar_table_url' result.employee.identifier  result.year result.month %}?p_role={{p_role}}">
						  				{% elif result.status == 'submitted' %}
						  				<a 	id="submit_timesheet_{{employee_id}}"
						  					title="View Timesheet"
						  					data-toggle="tooltip"
							    			data-placement="right"
							    			class="btn btn-info btn-sm"
							    			href="{% url 'timesheet_dashboard:timesheet_calendar_table_url' result.employee.identifier  result.year result.month %}?p_role={{p_role}}">
						  				{% else %}
						  				<a 	id="submit_timesheet_{{employee_id}}"
						  					title="View Timesheet"
						  					data-toggle="tooltip"
						  					data-placement="right"
						  					class="btn btn-success btn-sm"
						  					href="{% url 'timesheet_dashboard:timesheet_calendar_table_url' result.employee.identifier  result.year result.month %}?p_role={{p_role}}">
						  				{% endif %} 
						  				View Timesheet</a>
									{% endif %}
									</div>
			        	 		</td>
			        	 	{% endblock listboard_table_button_column %}
			
			        	 	{% block listboard_table_columns %}
			        	 		{% if p_role == 'HR' or p_role == 'Supervisor' %}
			        	 		<td>{{result.object.employee.first_name}} {{result.object.employee.last_name}}</td>
			        	 		{% endif %}
			        	 		<td>{{ result.month|month_name }}-{{ result.year }}</td>
			        	 		<td>{{ result.object.total_hours }}</td>
			        	 		<td>{{ result.timesheet_status }}</td>
			        	 		<td>{{ result.object.submitted_datetime|date:"SHORT_DATETIME_FORMAT" }}</td>
			        	 		<td>{{ result.approved_by }}</td>
			        	 		<td>{{ result.verified_by }}</td>
							{% endblock listboard_table_columns %}
			          	</tr>
          				{% empty %}
			          	<tr>
			          		<td colspan="9" class="text-center text-secondary">No timesheets found.</td>
			          	</tr>
          				{% endfor %}
					{% endblock listboard_table_body %}
        			</tbody>
      			</table>
			</div>
  		</div>
  		<div class="card-footer d-flex flex-column align-items-center">
  			{% paginator_row %}
      	</div>
    </div>
 </div>
 <!-- Side panel with employee details (visible on lg+, offcanvas on mobile) -->
 <div class="col-12 col-lg-3 d-none d-lg-block">
  	<div class="md-card h-100 sticky-lg-top" style="top: 1rem;">
      <div class="card-body">
        <h5 class="card-title d-flex justify-content-between align-items-center p-3 bg-info bg-opacity-10 border border-info rounded-start rounded-end">
        	<span>Employee Details</span>
        	{% if 'Supervisor' in groups %}
        		<a href="{% url timesheet_employee_listboard_url %}?p_role=Supervisor&edc_readonly=1" class="btn btn-sm btn-outline-secondary">Supervisees</a>
        	{% endif %}
        	{% if 'HR' in groups %}
        		<a href="{% url timesheet_employee_listboard_url %}?p_role=HR&edc_readonly=1" class="btn btn-sm btn-outline-secondary">Employees</a>
        	{% endif %}
        </h5>
        <div id="details">
        	{% demographics employee_id %}
        </div>
      </div>
  </div>
</div>
</div>

{% endblock main %}
